<!DOCTYPE html>
<html>

<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/5.2.0/firebase.js"></script>

    <script src="push.js"></script>
    <script src="service-worker.js"></script>

    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */

        #map {
            height: 80%;
        }

        /* Optional: Makes the sample page fill the window. */

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Bike Finder</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Lost/Stolen Bike?
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Found a Bike?</a>
                </li>
                <!-- <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        Dropdown
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#">Disabled</a>
                </li> -->
            </ul>
            <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form>
        </div>
    </nav>
    <div id="map"></div>
    <div id="map" height="460px" width="100%"></div>
    <div id="form">
        <table>
            <tr>
                <td>Status:</td>
                <td>
                    <fieldset id="status-input">
                        <input type="radio" value="" name="status-input">Lost/Stolen
                        <input type="radio" value="1" name="status-input">Found
                    </fieldset>
                </td>
            </tr>
            <tr>
                <td>Make:</td>
                <td>
                    <input type='text' id='make-input' /> </td>
            </tr>
            <tr>
                <td>Model:</td>
                <td>
                    <input type='text' id='model-input' /> </td>
            </tr>
            <tr>
                <td>Color:</td>
                <td>
                    <input type='text' id='color-input' /> </td>
            </tr>
            <tr>
                <td>Age:</td>
                <td>
                    <input type='text' id='age-input' /> </td>
            </tr>
            <tr>
                <td>Size:</td>
                <td>
                    <input type='text' id='size-input' /> </td>
            </tr>
            <tr>
                <td>License:</td>
                <td>
                    <input type='text' id='license-input' /> </td>
            </tr>
            <tr>
                <td>Serial Number:</td>
                <td>
                    <input type='text' id='serial-input' /> </td>
            </tr>
            <tr>
                <td>Image:</td>
                <td>
                    <div id='filesubmit'>
                        <input id="image-input" type="file" class='file-select' name="pic" accept="image/*">
                        <!-- <input type="submit"> -->
                        </form>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <input type='button' class='file-submit' value='Submit' onclick="saveData()" />
                </td>
            </tr>
        </table>
        </div>
        <div id="message">Location saved</div>
        <script>
            var map;
            var marker;
            var infowindow;
            var messagewindow;
            // var data = {
            //     sender: null,
            //     timestamp: null,
            //     lat: null,
            //     lng: null
            // };
            // var firebase = new Firebase("https://bike-finder-project.firebaseio.com");


            function initMap() {
                var denver = {
                    lat: 39.680429,
                    lng: -104.965109,
                    styles: [{
                        featureType: 'poi',
                        stylers: [{
                            visibility: 'off'
                        }] // Turn off points of interest.
                    }, {
                        featureType: 'transit.station',
                        stylers: [{
                            visibility: 'off'
                        }] // Turn off bus stations, train stations, etc.
                    }],
                    disableDoubleClickZoom: true

                };
                map = new google.maps.Map(document.getElementById('map'), {
                    center: denver,
                    zoom: 13
                });
                // Create the DIV to hold the control and call the makeInfoBox() constructor
                // passing in this DIV.



                infowindow = new google.maps.InfoWindow({
                    content: document.getElementById('form')
                });

                messagewindow = new google.maps.InfoWindow({
                    content: document.getElementById('message')
                });

                google.maps.event.addListener(map, 'click', function (event) {
                    marker = new google.maps.Marker({
                        position: event.latLng,
                        map: map
                    });


                    google.maps.event.addListener(marker, 'click', function () {
                        infowindow.open(map, marker);
                    });
                });
            }

            function saveData() {
                // event.preventDefault();
                // Grabbed values from text boxes
                make = $("#make-input").val().trim();
                model = $("#model-input").val().trim();
                color = $("#color-input").val().trim();
                age = $("#age-input").val().trim();
                size = $("#size-input").val().trim();
                license = $("#license-input").val().trim();
                serial = $("#serial-input").val().trim();
                image = '';
                database.ref().on("value", function (snapshot) {
                    snapshot.forEach(function (childSnapshot) {
                        var childData = childSnapshot.val();
                        var id = childData.id;
                        console.log(childData.id);
                    });
                });

                // Code for handling the push
                database.ref().push({
                    make: make,
                    model: model,
                    color: color,
                    age: age,
                    size: size,
                    license: license,
                    serial: serial,
                    status: status,
                    image: image,
                    dateAdded: firebase.database.ServerValue.TIMESTAMP

                });
            }

            function downloadUrl(url, callback) {
                var request = window.ActiveXObject ?
                    new ActiveXObject('Microsoft.XMLHTTP') :
                    new XMLHttpRequest;

                request.onreadystatechange = function () {
                    if (request.readyState == 4) {
                        request.onreadystatechange = doNothing;
                        callback(request.responseText, request.status);
                    }
                };

                request.open('GET', url, true);
                request.send(null);
            }




            // function loadPointsFromFirebase(map) { // pass the initialised map to the function
            //     var marker = {};
            //     // var db = firebase.database();
            //     database.ref('clicks').ones('value', points => {
            //         points.forEach(point => {
            //             marker = new google.maps.Marker({
            //                 map: map,
            //                 position: {
            //                     lat: point.val().lat,
            //                     lng: point.val().lng
            //                 }
            //             })
            //             marker.setMap(map) // Set market on the map 
            //         })
            //     })



            // }

            function doNothing() {}


            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyBdz2Q4if_BfZQP0xRvFsqpyfzUE7TcjKQ",
                authDomain: "bike-finder-project.firebaseapp.com",
                databaseURL: "https://bike-finder-project.firebaseio.com",
                projectId: "bike-finder-project",
                storageBucket: "bike-finder-project.appspot.com",
                messagingSenderId: "630877659629"
            };
            firebase.initializeApp(config);

            // Create a variable to reference the database.
            var database = firebase.database();
            //Listen for new added users
            database.ref().on("child_added", function (snapshot) {
                var snapValue = snapshot.val();
                var seconds = snapValue.dateAdded;
                var d = new Date(0);
                d.setUTCSeconds(seconds);
                console.log(d);
                //                 $("#data-area").append(
                //                     `
                // <div class="lost-bike">
                // <p>${snapValue.make}</p>
                // <p>${snapValue.model}</p>
                // <p>${snapValue.color}</p>
                // <p>${snapValue.age}</p>
                // <p>${snapValue.size}</p>
                // <p>${snapValue.license}</p>
                // <p>${snapValue.serial}</p>
                // <hr />
                // </div>
                // `
                // )
            });
            // Initial Values
            var make = "";
            var model = "";
            var color = "";
            var age = "";
            var size = "";
            var license = "";
            var serial = "";
            var status = "";


            // Capture Button Click
            $("#add-user").on("click", function (event) {
                // event.preventDefault();
                // Grabbed values from text boxes
                make = $("#make-input").val().trim();
                model = $("#model-input").val().trim();
                color = $("#color-input").val().trim();
                age = $("#age-input").val().trim();
                size = $("#size-input").val().trim();
                license = $("#license-input").val().trim();
                serial = $("#serial-input").val().trim();
                status = $("#status-input").val().trim();
                // map.addListener('click', function (e) {
                //     data.lat = e.latLng.lat();
                //     data.lng = e.latLng.lng();
                //     addToFirebase(data);
                //     console.log(e.latLng.lat());
                // });


                // Code for handling the push
                database.ref().push({

                    make: make,
                    model: model,
                    color: color,
                    age: age,
                    size: size,
                    license: license,
                    serial: serial,
                    status: status,
                    dateAdded: firebase.database.ServerValue.TIMESTAMP,

                });

            });
        </script>
        <!-- function initMap() { map = new google.maps.Map(document.getElementById('map'), { center: { lat: 39.680429, lng: -104.965109
    }, zoom: 13 }); } -->
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC4d7jTSocgsZ7WSgh2LHVj_D3LPbQ3QVw&callback=initMap" async
            defer></script>

</body>

</html>